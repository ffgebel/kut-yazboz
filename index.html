<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Küt Yaz Bozu - Modern Okey Oyunu</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Varsayılan olarak koyu tema için değişkenler */
        :root {
            --primary-bg: linear-gradient(135deg, #2c3e50, #4a4a4a); /* Koyu gri tonları */
            --secondary-bg: linear-gradient(135deg, #34495e, #5d6d7e); /* Hafif koyu mavi-gri */
            --text-primary: #ecf0f1; /* Açık gri metin */
            --text-secondary: #c0c0c0; /* Daha az vurgulu metin */
            --card-bg: rgba(0, 0, 0, 0.3); /* Koyu kart arka planı */
            --card-border: 1px solid rgba(255, 255, 255, 0.1);
            --input-bg: rgba(255, 255, 255, 0.05);
            --input-border: rgba(255, 255, 255, 0.1);
            --shadow-light: rgba(0, 0, 0, 0.4);
            --shadow-dark: rgba(0, 0, 0, 0.3);
            --score-value-color: #a7d9ff; /* Açık mavi skor */
            --leader-color: #8aff8a; /* Yeşil lider */
            --button-gradient: linear-gradient(135deg, #4b6cb7, #182848); /* Koyu mavi buton */
            --toggle-bg: rgba(255, 255, 255, 0.2);
            --toggle-ball: white;
            --table-row-hover: rgba(255, 255, 255, 0.1);
            --current-task-bg: linear-gradient(90deg, #34495e, #182848); /* Koyu mavi-gri görev */
            --completed-task-bg: rgba(0, 255, 0, 0.1);

            /* RGB değerleri, parlama efektleri için */
            --score-value-color-rgb: 167, 217, 255;

            /* Undo/Redo butonları için yeni renkler */
            --undo-redo-bg: linear-gradient(135deg, #f06a6a, #c0392b); /* Kırmızı tonları */
            --undo-redo-hover: linear-gradient(135deg, #e74c3c, #a72d20);
        }

        /* Kumar Masası Yeşili Teması */
        body.green-theme {
            --primary-bg: linear-gradient(135deg, #2d7a41, #1e5a2e); /* Koyu yeşil arka plan */
            --secondary-bg: linear-gradient(135deg, #3a9452, #29743c); /* Orta yeşil tonlar */
            --text-primary: #f0f8ff; /* Açık krem metin */
            --text-secondary: #e0e0e0;
            --card-bg: rgba(0, 0, 0, 0.4); /* Şeffaf koyu kartlar */
            --card-border: 1px solid rgba(255, 255, 255, 0.15);
            --input-bg: rgba(255, 255, 255, 0.08);
            --input-border: rgba(255, 255, 255, 0.2);
            --shadow-light: rgba(0, 0, 0, 0.5);
            --shadow-dark: rgba(0, 0, 0, 0.4);
            --score-value-color: #fceb9f; /* Altın sarısı skor */
            --leader-color: #a0ffab; /* Açık yeşil lider */
            --button-gradient: linear-gradient(135deg, #ffc107, #ff9800); /* Turuncu/sarı butonlar */
            --toggle-bg: rgba(255, 255, 255, 0.3);
            --toggle-ball: #ffc107; /* Sarı top */
            --table-row-hover: rgba(255, 255, 255, 0.15);
            --current-task-bg: linear-gradient(90deg, #4CAF50, #8BC34A); /* Canlı yeşil görev */
            --completed-task-bg: rgba(0, 255, 0, 0.15);

            /* RGB değerleri, parlama efektleri için */
            --score-value-color-rgb: 252, 235, 159;

            /* Undo/Redo butonları için yeni renkler */
            --undo-redo-bg: linear-gradient(135deg, #ff9800, #f44336); /* Turuncu-kırmızı tonları */
            --undo-redo-hover: linear-gradient(135deg, #e68a00, #d32f2f);
        }

        /* Ortak Değişkenler */
        :root {
            --border-radius: 20px;
            --transition-speed: 0.3s;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--primary-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: background var(--transition-speed) ease-in-out, color var(--transition-speed) ease-in-out;
            font-size: 16px;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: 0 10px 20px var(--shadow-light), 0 6px 6px var(--shadow-dark);
            border: var(--card-border);
            transition: transform var(--transition-speed) ease-in-out, box-shadow var(--transition-speed) ease-in-out, background var(--transition-speed) ease-in-out;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px var(--shadow-light), 0 8px 8px var(--shadow-dark);
        }

        h1, h2, h3 {
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            color: var(--text-primary);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }

        .input-group label {
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95em;
            color: var(--text-secondary);
        }

        .input-group input {
            padding: 14px 20px;
            border-radius: 10px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: 1.0em;
            outline: none;
            transition: all var(--transition-speed) ease;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .input-group input:focus {
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.12);
        }

        .team-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .player-name-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px var(--shadow-dark);
            transition: transform var(--transition-speed) ease, background var(--transition-speed) ease;
        }

        .player-name-card:hover {
            transform: scale(1.02);
        }

        .player-name-card h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
            font-weight: 500;
            color: var(--text-primary);
        }

        .player-name-card input {
            width: calc(100% - 20px);
            padding: 10px 10px;
            border-radius: 8px;
            border: 1px solid var(--input-border);
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: 0.95em;
            outline: none;
        }
        .player-name-card input:focus {
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px 25px;
            border-radius: 12px;
            background: var(--button-gradient);
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
            border: none;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 5px 15px var(--shadow-dark);
            margin-top: 20px;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow-dark);
            opacity: 0.95;
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px var(--shadow-dark);
        }

        .flex-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: stretch;
        }

        .flex-item {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }

        .current-score-display {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-bottom: 10px;
        }

        .team-score {
            flex: 1;
        }

        .team-score h3 {
            margin-bottom: 5px;
            font-size: 1.5em;
            font-weight: 500;
            color: var(--text-primary);
        }

        .score-value {
            font-size: 3em;
            font-weight: 700;
            color: var(--score-value-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .score-difference-display {
            background-color: var(--input-bg);
            border-radius: 15px;
            padding: 10px 20px;
            margin-top: 15px;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.1em;
            font-weight: 500;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--card-border);
            color: var(--text-primary);
        }
        .score-difference-display .leader {
            color: var(--leader-color);
            font-weight: 700;
        }

        .current-round-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--input-bg);
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 25px;
            font-size: 1.1em;
            font-weight: 500;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--input-border);
            color: var(--text-primary);
        }

        .current-round-info strong {
            font-weight: 700;
            color: var(--score-value-color);
        }

        .score-entry-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .score-entry-section h3 {
            font-size: 1.4em;
            margin-bottom: 5px;
        }

        .score-input-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--input-bg);
            border-radius: 12px;
            padding: 12px 20px;
            border: 1px solid var(--input-border);
            box-shadow: 0 4px 8px var(--shadow-dark);
            transition: all var(--transition-speed) ease;
        }

        .score-input-item:focus-within {
            border-color: var(--score-value-color);
            box-shadow: 0 0 0 4px rgba(var(--score-value-color-rgb), 0.3);
            transform: translateY(-2px);
        }

        .score-input-item label {
            flex-grow: 1;
            font-size: 1.1em;
            font-weight: 500;
            color: var(--text-primary);
            margin-right: 15px;
            text-align: left;
        }

        .score-input {
            width: 100px;
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid var(--input-border);
            background-color: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            font-size: 1.2em;
            font-weight: 600;
            text-align: center;
            -moz-appearance: textfield;
            transition: all var(--transition-speed) ease;
        }
        .score-input::-webkit-outer-spin-button,
        .score-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .score-input:focus {
            border-color: var(--score-value-color);
            box-shadow: 0 0 0 2px rgba(var(--score-value-color-rgb), 0.2);
            background-color: rgba(255, 255, 255, 0.15);
        }

        .quick-score-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Masaüstünde 2 sütun */
            gap: 15px; /* Butonlar arası boşluk artırıldı */
            margin-top: 15px;
        }

        .quick-score-buttons > div { /* Her bir takımın butonlarını sarmalayan div */
            display: flex;
            flex-direction: column;
            gap: 10px; /* Bir takımın butonları arası boşluk */
        }

        .quick-score-buttons button {
            padding: 15px 18px; /* Butonların iç boşluğu artırıldı */
            border-radius: 12px; /* Köşeler daha yuvarlak */
            border: none;
            background: var(--button-gradient);
            color: white;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 3px 10px var(--shadow-dark);
            width: 100%; /* Butonlar tam genişlik kaplasın */
        }

        .quick-score-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px var(--shadow-dark);
            opacity: 0.9;
        }
        .quick-score-buttons button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px var(--shadow-dark);
        }

        /* Undo/Redo Butonları için yeni stil */
        .undo-redo-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .undo-redo-buttons button {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            background: var(--undo-redo-bg);
            color: white;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 3px 10px var(--shadow-dark);
            flex: 1; /* Butonların eşit genişlikte olması için */
        }

        .undo-redo-buttons button:hover {
            background: var(--undo-redo-hover);
            transform: translateY(-2px);
            box-shadow: 0 5px 12px var(--shadow-dark);
        }

        .undo-redo-buttons button:disabled {
            background: rgba(128, 128, 128, 0.5);
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
            transform: none;
        }


        .score-table-container {
            overflow-x: auto;
            margin-top: 25px;
        }

        .score-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
            text-align: center;
        }

        .score-table th,
        .score-table td {
            padding: 15px 10px;
            background-color: var(--input-bg);
            backdrop-filter: blur(5px);
            border: 1px solid var(--input-border);
            color: var(--text-primary);
        }

        .score-table th {
            font-weight: 600;
            font-size: 1.1em;
            background-color: rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--score-value-color);
        }

        .score-table tbody tr:hover td {
            background-color: var(--table-row-hover);
            transition: background-color var(--transition-speed) ease;
        }

        .score-table th:first-child,
        .score-table td:first-child {
            border-top-left-radius: 10px;
            border-bottom-left-radius: 10px;
        }

        .score-table th:last-child,
        .score-table td:last-child {
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
        }


        .task-list {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: left;
        }

        .task-list li {
            background-color: var(--input-bg);
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 2px 5px var(--shadow-dark);
            position: relative;
            color: var(--text-primary);
        }
        
        .task-list li.current::before {
            content: '👉';
            position: absolute;
            left: 5px;
            font-size: 1.2em;
            transform: translateY(-50%);
            top: 50%;
        }
        .task-list li.current {
            padding-left: 40px;
            background: var(--current-task-bg);
            font-weight: 600;
            transform: scale(1.02);
            box-shadow: 0 5px 10px var(--shadow-dark);
        }

        .task-list li.completed {
            background-color: var(--completed-task-bg);
            text-decoration: line-through;
            opacity: 0.7;
            font-style: italic;
        }

        .game-over-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            animation: fadeIn 0.5s forwards;
            color: white;
        }

        .game-over-screen h2 {
            font-size: 3.5em;
            color: #ffe082;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            animation: slideInDown 0.8s ease-out;
        }

        .game-over-screen .final-scores {
            font-size: 1.8em;
            margin-bottom: 40px;
            line-height: 1.6;
            animation: zoomIn 1s ease-out;
        }

        .game-over-screen .final-scores .winner {
            color: #8aff8a;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
        }

        .game-over-screen button {
            padding: 18px 35px;
            font-size: 1.3em;
            border-radius: 15px;
            background: var(--button-gradient);
            color: white;
            border: none;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 8px 20px var(--shadow-dark);
            animation: pulse 1.5s infinite;
        }

        .game-over-screen button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: white;
            opacity: 0;
            animation: fall 3s ease-out forwards;
            border-radius: 50%;
        }

        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        /* Tema Değiştirme Düğmesi */
        .toggle-switch-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .toggle-switch {
            width: 60px;
            height: 30px;
            background-color: var(--toggle-bg);
            border-radius: 30px;
            position: relative;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease;
            box-shadow: 0 2px 5px var(--shadow-dark);
        }

        .toggle-switch-ball {
            width: 26px;
            height: 26px;
            background-color: var(--toggle-ball);
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform var(--transition-speed) ease, background-color var(--transition-speed) ease;
            box-shadow: 0 2px 5px var(--shadow-dark);
        }

        .toggle-switch.active .toggle-switch-ball {
            transform: translateX(30px);
        }


        /* Responsive Ayarlamalar */
        @media (max-width: 768px) {
            body {
                font-size: 15px; /* Genel font boyutunu küçülttüm */
            }

            .container {
                width: 95%;
                padding: 15px;
            }

            .card {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            h2 {
                font-size: 1.5em;
            }

            .flex-container {
                flex-direction: column;
            }

            .flex-item {
                min-width: unset;
                width: 100%;
            }

            .current-score-display {
                flex-direction: column;
                gap: 15px;
            }

            .score-value {
                font-size: 2.8em; /* Mobil için biraz küçültme */
            }

            .current-round-info {
                flex-direction: column;
                gap: 10px;
                padding: 10px 15px;
            }

            .score-input-item {
                flex-direction: column; /* Mobil'de etiket ve input alt alta */
                align-items: flex-start; /* Sola hizala */
                gap: 5px; /* Aralarındaki boşluğu azalt */
                padding: 10px 15px; /* İç boşluğu ayarla */
            }

            .score-input-item label {
                margin-bottom: 5px;
                font-size: 1em; /* Mobil için etiket font boyutu */
                width: 100%; /* Etiket tam genişlik kaplasın */
                text-align: left; /* Metni sola hizala */
            }

            .score-input {
                width: 100%; /* Input tam genişlik kaplasın */
                box-sizing: border-box; /* Padding ve border genişliğe dahil */
                text-align: left; /* Metni sola hizala */
                font-size: 1.1em; /* Mobil için input font boyutu */
                padding: 10px 12px; /* Input'un iç boşluğunu ayarla */
            }

            .quick-score-buttons {
                grid-template-columns: 1fr; /* **Mobil cihazlarda butonlar tek sütun** */
                gap: 10px; /* Takımlar arası boşluk */
            }
            .quick-score-buttons > div {
                 gap: 8px; /* Bir takımın butonları arası boşluk */
            }
             .quick-score-buttons button {
                font-size: 1.1em; /* Mobil buton fontu daha büyük */
                padding: 18px 15px; /* Mobil buton iç boşluğu daha fazla */
             }

            .undo-redo-buttons {
                flex-direction: column; /* Mobil'de alt alta */
                gap: 8px;
            }
            .undo-redo-buttons button {
                font-size: 1em;
                padding: 12px 15px;
            }

            .game-over-screen h2 {
                font-size: 2.5em;
            }

            .game-over-screen .final-scores {
                font-size: 1.4em;
            }

            .game-over-screen button {
                padding: 15px 25px;
                font-size: 1.1em;
            }

            .toggle-switch-container {
                top: 15px;
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px; /* Daha küçük ekranlar için genel font boyutu */
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.3em;
            }
            .player-name-card h3 {
                font-size: 1em;
            }
            .player-name-card input {
                font-size: 0.85em;
            }
            .btn {
                font-size: 0.95em;
                padding: 12px 20px;
            }
            .score-table th,
            .score-table td {
                padding: 10px 5px;
                font-size: 0.85em;
            }
            .score-value {
                font-size: 2.2em; /* Çok küçük ekranlar için daha da küçültme */
            }
            .quick-score-buttons button {
                font-size: 1em; /* Çok küçük ekranlarda buton fontu */
                padding: 15px 10px; /* Çok küçük ekranlarda buton iç boşluğu */
            }
        }
    </style>
</head>
<body class="dark-mode">
    <div class="toggle-switch-container">
        <div class="toggle-switch" id="themeToggle">
            <div class="toggle-switch-ball"></div>
        </div>
    </div>

    <div class="container" id="playerSetupScreen">
        <div class="card">
            <h1>Küt Yaz Bozu</h1>
            <h2>Oyuncu İsimleri (İsteğe Bağlı) ve Takımlar</h2>
            <div class="team-selection">
                <div class="player-name-card">
                    <h3>Takım 1 Oyuncu 1</h3>
                    <input type="text" id="player1Name" placeholder="Oyuncu 1 Adı">
                </div>
                <div class="player-name-card">
                    <h3>Takım 1 Oyuncu 2</h3>
                    <input type="text" id="player2Name" placeholder="Oyuncu 2 Adı">
                </div>
                <div class="player-name-card">
                    <h3>Takım 2 Oyuncu 1</h3>
                    <input type="text" id="player3Name" placeholder="Oyuncu 3 Adı">
                </div>
                <div class="player-name-card">
                    <h3>Takım 2 Oyuncu 2</h3>
                    <input type="text" id="player4Name" placeholder="Oyuncu 4 Adı">
                </div>
            </div>
            <button class="btn" id="startGameBtn">Oyunu Başlat</button>
        </div>
    </div>

    <div class="container" id="gameScreen" style="display: none;">
        <div class="flex-container">
            <div class="flex-item">
                <div class="card">
                    <div class="current-score-display">
                        <div class="team-score">
                            <h3>Takım 1</h3>
                            <span class="score-value" id="team1TotalScore">0</span>
                        </div>
                        <div class="team-score">
                            <h3>Takım 2</h3>
                            <span class="score-value" id="team2TotalScore">0</span>
                        </div>
                    </div>
                    <div class="score-difference-display" id="scoreDifferenceDisplay">
                        </div>

                    <div class="current-round-info">
                        <span id="dealerInfo">Dağıtan: <strong>P1</strong></span>
                        <span id="roundCounter">El: <strong>1 / 10</strong></span>
                    </div>

                    <div class="score-entry-section">
                        <h3>El Skoru Girin</h3>
                        <div class="score-input-item">
                            <label for="team1RoundScoreInput">Takım 1 Skoru:</label>
                            <input type="number" id="team1RoundScoreInput" class="score-input" value="0">
                        </div>
                        <div class="score-input-item">
                            <label for="team2RoundScoreInput">Takım 2 Skoru:</label>
                            <input type="number" id="team2RoundScoreInput" class="score-input" value="0">
                        </div>
                        <div class="quick-score-buttons">
                            <div> <button onclick="applyQuickScore(-100, 'team1')">Takım 1 Bitti (-100)</button>
                                <button onclick="applyQuickScore(-200, 'team1')">Takım 1 Okey Vurdu (-200)</button>
                            </div>
                            <div> <button onclick="applyQuickScore(-100, 'team2')">Takım 2 Bitti (-100)</button>
                                <button onclick="applyQuickScore(-200, 'team2')">Takım 2 Okey Vurdu (-200)</button>
                            </div>
                        </div>
                        <button class="btn" id="submitRoundScore">El Skorunu Kaydet</button>
                    </div>
                </div>
            </div>

            <div class="flex-item">
                <div class="card">
                    <h2>Detaylı Skor Tablosu</h2>
                    <div class="score-table-container">
                        <table class="score-table" id="scoreTable">
                            <thead>
                                <tr>
                                    <th>El</th>
                                    <th>Takım 1 Skoru</th>
                                    <th>Takım 2 Skoru</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                    <div class="undo-redo-buttons">
                        <button id="undoBtn" disabled>Geri Al</button>
                        <button id="redoBtn" disabled>İleri Al</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Oyun Görevleri</h2>
            <ul class="task-list" id="taskList">
                </ul>
        </div>
    </div>

    <div class="game-over-screen" id="gameOverScreen">
        <h2 id="gameOverTitle">Oyun Bitti!</h2>
        <div class="final-scores" id="finalScoresDisplay">
            </div>
        <button id="restartGameBtn">Yeniden Oyna</button>
    </div>

    <script>
        const playerSetupScreen = document.getElementById('playerSetupScreen');
        const gameScreen = document.getElementById('gameScreen');
        const startGameBtn = document.getElementById('startGameBtn');
        const submitRoundScoreBtn = document.getElementById('submitRoundScore');
        const restartGameBtn = document.getElementById('restartGameBtn');
        const team1TotalScoreElem = document.getElementById('team1TotalScore');
        const team2TotalScoreElem = document.getElementById('team2TotalScore');
        const dealerInfoElem = document.getElementById('dealerInfo');
        const roundCounterElem = document.getElementById('roundCounter');
        const scoreTableBody = document.querySelector('#scoreTable tbody');
        const taskList = document.getElementById('taskList');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const gameOverTitle = document.getElementById('gameOverTitle');
        const finalScoresDisplay = document.getElementById('finalScoresDisplay');
        const themeToggle = document.getElementById('themeToggle');
        const scoreDifferenceDisplay = document.getElementById('scoreDifferenceDisplay');
        const undoBtn = document.getElementById('undoBtn'); // Yeni buton
        const redoBtn = document.getElementById('redoBtn'); // Yeni buton

        let playerNames = ['', '', '', ''];
        let teamRoundScores = []; // Her elin skorunu tutar [[t1_skor, t2_skor], ...]
        let teamScores = [0, 0]; // Mevcut toplam skorlar
        let currentRound = 1;
        let dealerIndex = 0;
        const maxRounds = 10;

        // Geri alma/ileri alma geçmişi
        let history = [];
        let historyPointer = -1; // -1, henüz hiçbir elin kaydedilmediği anlamına gelir.

        const tasks = [
            "4’lü küt",
            "4’lü seri",
            "4’lü küt 3’lü seri",
            "4’lü seri 3’lü küt",
            "5’li seri",
            "2 tane 4’lü küt",
            "2 tane 4’lü seri",
            "4’lü küt 5’li seri",
            "5 çift",
            "Elden bitiş"
        ];

        // --- Core Game Logic ---

        function startGame() {
            playerNames[0] = document.getElementById('player1Name').value || 'Oyuncu 1';
            playerNames[1] = document.getElementById('player2Name').value || 'Oyuncu 2';
            playerNames[2] = document.getElementById('player3Name').value || 'Oyuncu 3';
            playerNames[3] = document.getElementById('player4Name').value || 'Oyuncu 4';

            playerSetupScreen.style.display = 'none';
            gameScreen.style.display = 'flex';

            resetGame();
        }

        function resetGame() {
            teamRoundScores = [];
            teamScores = [0, 0];
            currentRound = 1;
            dealerIndex = 0;
            history = [];
            historyPointer = -1; // Geçmişi sıfırla
            scoreTableBody.innerHTML = '';
            updateTotalScores();
            clearScoreInputs();
            updateGameInfo();
            updateTaskList();
            updateScoreDifference();
            gameOverScreen.style.display = 'none';
            updateUndoRedoButtons(); // Buton durumlarını güncelle
        }

        function updateGameInfo() {
            dealerInfoElem.innerHTML = `Dağıtan: <strong>${playerNames[dealerIndex]}</strong>`;
            roundCounterElem.innerHTML = `El: <strong>${currentRound} / ${maxRounds}</strong>`;
        }

        function updateTotalScores() {
            team1TotalScoreElem.textContent = teamScores[0];
            team2TotalScoreElem.textContent = teamScores[1];
        }

        function updateTaskList() {
            taskList.innerHTML = '';
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${index + 1}. ${task}</span>`;
                if (index + 1 === currentRound) {
                    li.classList.add('current');
                } else if (index + 1 < currentRound) {
                    li.classList.add('completed');
                }
                taskList.appendChild(li);
            });
        }

        function clearScoreInputs() {
            document.getElementById('team1RoundScoreInput').value = 0;
            document.getElementById('team2RoundScoreInput').value = 0;
        }

        function applyQuickScore(score, teamId) {
            if (teamId === 'team1') {
                document.getElementById('team1RoundScoreInput').value = score;
            } else if (teamId === 'team2') {
                document.getElementById('team2RoundScoreInput').value = score;
            }
        }

        function submitRoundScore() {
            // Oyun bittiyse yeni skor eklenemez
            if (currentRound > maxRounds) {
                showGameOverScreen();
                return;
            }

            const team1RoundScore = parseInt(document.getElementById('team1RoundScoreInput').value);
            const team2RoundScore = parseInt(document.getElementById('team2RoundScoreInput').value);

            // Yeni el eklendiğinde, historyPointer'dan sonraki tüm ileri alma geçmişini sil
            history = history.slice(0, historyPointer + 1);

            // Mevcut durumu geçmişe kaydet
            history.push({
                roundScores: [team1RoundScore, team2RoundScore], // Bu elin skorları
                totalScores: [...teamScores], // Bu elden önceki toplam skorlar
                round: currentRound,
                dealer: dealerIndex
            });
            historyPointer++;

            // Mevcut skorları ve turu güncelle
            teamScores[0] += team1RoundScore;
            teamScores[1] += team2RoundScore;
            currentRound++;
            dealerIndex = (dealerIndex + 1) % 4;

            renderScoresFromHistory(); // Tüm skor tablosunu geçmişten yeniden çiz
            clearScoreInputs();
            updateGameInfo();
            updateTaskList();
            updateScoreDifference();
            updateUndoRedoButtons();

            if (currentRound > maxRounds) {
                showGameOverScreen();
            }
        }

        function addScoreRow(round, team1RScore, team2RScore) {
            const row = scoreTableBody.insertRow();
            row.insertCell().textContent = round;
            row.insertCell().textContent = team1RScore;
            row.insertCell().textContent = team2RScore;
        }

        function renderScoresFromHistory() {
            scoreTableBody.innerHTML = ''; // Tabloyu temizle
            let tempTeamScores = [0, 0];

            for (let i = 0; i <= historyPointer; i++) {
                const entry = history[i];
                tempTeamScores[0] += entry.roundScores[0];
                tempTeamScores[1] += entry.roundScores[1];
                addScoreRow(i + 1, entry.roundScores[0], entry.roundScores[1]);
            }
            teamScores = [...tempTeamScores]; // Güncel toplam skorları ayarla
            updateTotalScores();
        }

        function undoLastRound() {
            if (historyPointer >= 0) {
                historyPointer--;
                // Eğer geri alınacak el kalmadıysa, oyunu sıfırla
                if (historyPointer < 0) {
                    resetGame(); // Tamamen sıfırla
                } else {
                    const previousState = history[historyPointer];
                    teamScores = [...previousState.totalScores]; // Önceki toplam skorları yükle
                    currentRound = previousState.round;
                    dealerIndex = previousState.dealer;

                    renderScoresFromHistory(); // Tabloyu ve toplam skorları yeniden çiz
                    updateGameInfo();
                    updateTaskList();
                    updateScoreDifference();
                    updateUndoRedoButtons();
                    gameOverScreen.style.display = 'none'; // Oyun bitiş ekranını gizle
                }
            }
        }

        function redoLastRound() {
            if (historyPointer < history.length - 1) {
                historyPointer++;
                const nextState = history[historyPointer];
                renderScoresFromHistory(); // Tabloyu ve toplam skorları yeniden çiz
                currentRound = nextState.round + 1; // currentRound'ı bir sonraki elin başlangıcı olarak ayarla
                dealerIndex = (nextState.dealer + 1) % 4; // dealerIndex'i bir sonraki el için ayarla

                updateGameInfo();
                updateTaskList();
                updateScoreDifference();
                updateUndoRedoButtons();
                // Redo yapıldıktan sonra eğer son ele geldiyse ve oyun bittiyse ekranı göster
                if (currentRound > maxRounds) {
                    showGameOverScreen();
                }
            }
        }


        function updateScoreDifference() {
            const diff = Math.abs(teamScores[0] - teamScores[1]);
            let leaderInfo = '';

            if (teamScores[0] < teamScores[1]) {
                leaderInfo = `<span class="leader">Takım 1 ${diff} puan önde</span>`;
            } else if (teamScores[1] < teamScores[0]) {
                leaderInfo = `<span class="leader">Takım 2 ${diff} puan önde</span>`;
            } else {
                leaderInfo = `<span class="leader">Berabere</span>`;
            }
            
            scoreDifferenceDisplay.innerHTML = leaderInfo;
        }

        function showGameOverScreen() {
            gameScreen.style.display = 'none';
            gameOverScreen.style.display = 'flex';

            let winnerTeam = '';
            let winnerScore = 0;
            let loserTeam = '';
            let loserScore = 0;

            if (teamScores[0] < teamScores[1]) {
                winnerTeam = 'Takım 1';
                winnerScore = teamScores[0];
                loserTeam = 'Takım 2';
                loserScore = teamScores[1];
            } else if (teamScores[1] < teamScores[0]) {
                winnerTeam = 'Takım 2';
                winnerScore = teamScores[1];
                loserTeam = 'Takım 1';
                loserScore = teamScores[0];
            } else {
                winnerTeam = 'Berabere!';
                winnerScore = teamScores[0];
            }

            gameOverTitle.textContent = winnerTeam === 'Berabere!' ? 'Oyun Berabere!' : 'Oyun Bitti!';
            finalScoresDisplay.innerHTML = `
                ${winnerTeam === 'Berabere!' ? `
                    <p>Her iki takım da <strong>${winnerScore}</strong> puanla berabere kaldı!</p>
                ` : `
                    <p><strong class="winner">${winnerTeam}</strong> kazandı!</p>
                    <p>${winnerTeam}: <span class="winner">${winnerScore}</span> puan</p>
                    <p>${loserTeam}: <span>${loserScore}</span> puan</p>
                `}
            `;

            createConfetti();
        }

        function createConfetti() {
            const numConfetti = 50;
            for (let i = 0; i < numConfetti; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 70%)`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.animationDuration = `${2 + Math.random() * 2}s`;
                gameOverScreen.appendChild(confetti);
            }
        }

        function updateUndoRedoButtons() {
            undoBtn.disabled = historyPointer < 0;
            redoBtn.disabled = historyPointer >= history.length - 1;
        }


        // --- Event Listeners ---

        startGameBtn.addEventListener('click', startGame);
        submitRoundScoreBtn.addEventListener('click', submitRoundScore);
        restartGameBtn.addEventListener('click', () => {
            gameOverScreen.style.display = 'none';
            playerSetupScreen.style.display = 'flex';
            document.getElementById('player1Name').value = '';
            document.getElementById('player2Name').value = '';
            document.getElementById('player3Name').value = '';
            document.getElementById('player4Name').value = '';
        });

        undoBtn.addEventListener('click', undoLastRound);
        redoBtn.addEventListener('click', redoLastRound);

        // Tema değiştirme fonksiyonu
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('green-theme');
            themeToggle.classList.toggle('active');
        });

        // Sayfa yüklendiğinde varsayılan ayarlar
        document.addEventListener('DOMContentLoaded', () => {
            updateGameInfo();
            updateTaskList();
            updateScoreDifference();
            updateUndoRedoButtons(); // Sayfa yüklendiğinde butonları devre dışı bırak
        });
    </script>
</body>
</html>
